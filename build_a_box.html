<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build Your Box â€¢ Daug's Desserts</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['Poppins', 'sans-serif'],
            sans: ['Poppins', 'sans-serif'],
          },
          colors: {
            brand: {
              green: '#3c6e47',
              yellow: '#f3bb41',
            },
            cream: {
              50: '#fdfcfb',
              100: '#faf8f5',
            },
            brown: {
              700: '#6b5435',
              800: '#4a3a24',
            },
          }
        }
      }
    }
  </script>

  <style>
    .header-buy-btn { background:#fff!important; color:#000!important; padding:8px 16px; border-radius:6px; font-family:'Poppins',sans-serif; font-weight:800; display:inline-block; }
    .header-logo { font-family:'Playfair Display',serif!important; font-weight:800!important; text-transform:lowercase; letter-spacing:-0.5px; }
    .hamburger span { display:block; width:18px; height:2px; margin:3px 0; background:white; border-radius:2px; }
  </style>
</head>

<body class="scroll-smooth bg-cream-50">

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-brand-green">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="relative flex items-center justify-between h-16">
      <button class="flex items-center gap-2 text-white hover:opacity-80 transition-opacity">
        <div class="hamburger"><span></span><span></span><span></span></div>
        <span class="text-sm font-bold font-sans">Menu</span>
      </button>

      <a href="index.html" class="header-logo absolute left-1/2 -translate-x-1/2 text-2xl text-white">
        Daug's Desserts
      </a>

      <a href="index.html#packs" class="header-buy-btn text-sm font-medium">Order Now</a>
    </div>
  </div>
</header>

<!-- MENU INDEX -->
<div class="sticky top-16 z-40 bg-white border-b border-gray-200 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <nav class="flex gap-8 py-4 overflow-x-auto">
      <a href="index.html#packs" class="text-sm font-medium text-gray-700 hover:text-brand-yellow whitespace-nowrap">Cookie Boxes</a>
      <a href="index.html#daily" class="text-sm font-medium text-gray-700 hover:text-brand-yellow whitespace-nowrap">Our Cookies</a>
      <a href="build_a_box.html" class="text-sm font-bold text-brand-green whitespace-nowrap">Build Your Box</a>
    </nav>
  </div>
</div>

<!-- HERO -->
<section class="py-16 bg-cream-100 border-b border-cream-300">
  <div class="max-w-6xl mx-auto px-4 grid lg:grid-cols-2 gap-12 items-center">
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <h1 class="font-serif text-5xl font-bold text-brown-800 mb-4">Build Your Box</h1>
      <p class="text-brown-700 text-lg leading-relaxed mb-6">
        Draft your dream lineup. Hit the exact count. Then checkout.
      </p>

      <div class="flex flex-col gap-3">
        <label class="text-brown-700 font-semibold">Choose Box Size</label>
        <select id="boxType" class="w-full p-3 rounded-lg border border-cream-300 focus:outline-none focus:ring-2 focus:ring-brand-yellow">
          <option value="dozen" selected>Dozen (12) â€” $24</option>
          <option value="six">Half-Dozen (6) â€” $14</option>
          <option value="big">Big Box (24) â€” $70</option>
        </select>

        <div class="mt-4">
          <div class="flex items-center justify-between mb-2">
            <span class="font-bold text-brown-800" id="counter">0/12 selected</span>
            <span class="text-sm text-brown-700" id="status">Pick 12 to unlock checkout.</span>
          </div>
          <div class="w-full h-3 rounded-full bg-white border border-cream-300 overflow-hidden">
            <div id="progress" class="h-3 bg-brand-yellow w-0"></div>
          </div>
        </div>

        <div class="flex gap-3 mt-4">
          <button id="randomize" class="px-6 py-3 rounded-md font-semibold bg-brand-green text-white hover:opacity-90 transition w-full">
            ðŸŽ² Chefâ€™s Draft
          </button>
          <button id="reset" class="px-6 py-3 rounded-md font-semibold bg-white border border-cream-300 text-brown-800 hover:opacity-90 transition w-full">
            Reset
          </button>
        </div>

        <button id="checkout"
          class="mt-2 px-6 py-3 rounded-md font-semibold bg-brand-yellow text-white hover:opacity-90 transition w-full disabled:opacity-40"
          disabled>
          Checkout â†’
        </button>

        <p class="text-xs text-brown-700 mt-2">
          Your selections are saved into your order at checkout.
        </p>
      </div>
    </div>

    <div class="rounded-2xl shadow-lg overflow-hidden">
      <img src="/images/Chocolate_Chip.webp" alt="Cookies" class="w-full h-full object-cover">
    </div>
  </div>
</section>

<!-- COOKIE GRID -->
<section class="py-12 bg-cream-50 border-t border-cream-200">
  <div class="max-w-6xl mx-auto px-4">
    <h2 class="font-serif text-3xl font-bold text-brown-800 mb-6">Pick Your Cookies</h2>
    <div id="cookieGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </div>
</section>

<!-- GIFT NOTE (optional) -->
<section class="py-12 bg-cream-50 border-t border-cream-200">
  <div class="max-w-3xl mx-auto px-4">
    <h2 class="font-serif text-3xl font-bold text-brown-800 mb-4">Add a Gift Note (Optional)</h2>
    <textarea id="giftNote" rows="4"
      class="w-full p-3 rounded-lg border border-cream-300 focus:outline-none focus:ring-2 focus:ring-brand-yellow"
      placeholder="To: / From: / Message..."></textarea>
  </div>
</section>

<!-- Footer (keep your existing footer here â€” paste it as-is) -->

<script>
  // ðŸ”§ CONFIG: point this to your backend endpoint later
  const API_CREATE_SESSION_URL = "https://YOUR-WORKER.your-domain.workers.dev/create-checkout-session";

  // Menu of flavors (use the exact names you want in fulfillment)
  const COOKIES = [
    { name: "Chocolate Chip", desc: "Classic. Soft-baked. Premium chips." },
    { name: "Gold Rush Sugar", desc: "Golden sweetness. Crowd favorite." },
    { name: "Triple Chocolate", desc: "Deep cocoa. Big mood." },
    { name: "Spicy Oatmeal", desc: "Warm spice. Cozy bite." },
    { name: "Caramel Macchiato", desc: "Coffee-forward. Smooth finish." },
    { name: "Ooey Gooey Butter", desc: "Soft, rich, unapologetic." },
  ];

  const BOX_RULES = {
    dozen: { required: 12, label: "Dozen", price: 2400 },
    six:   { required: 6,  label: "Half-Dozen", price: 1400 },
    big:   { required: 24, label: "Big Box", price: 7000 },
  };

  let selection = {}; // { "Chocolate Chip": 4, ... }
  let boxType = "dozen";

  const grid = document.getElementById("cookieGrid");
  const counter = document.getElementById("counter");
  const status = document.getElementById("status");
  const progress = document.getElementById("progress");
  const checkoutBtn = document.getElementById("checkout");
  const boxTypeEl = document.getElementById("boxType");

  function requiredCount() { return BOX_RULES[boxType].required; }
  function totalSelected() { return Object.values(selection).reduce((s, n) => s + n, 0); }

  function updateUI() {
    const total = totalSelected();
    const required = requiredCount();
    counter.textContent = `${total}/${required} selected`;
    progress.style.width = `${Math.min(100, (total / required) * 100)}%`;

    if (total < required) status.textContent = `Pick ${required - total} more to unlock checkout.`;
    if (total === required) status.textContent = `âœ… Box locked. Ready to checkout.`;
    if (total > required) status.textContent = `Too many selected. (Reset and try again)`;

    checkoutBtn.disabled = total !== required;
  }

  function render() {
    grid.innerHTML = "";
    COOKIES.forEach(c => {
      const qty = selection[c.name] || 0;

      const card = document.createElement("div");
      card.className = "bg-white rounded-2xl shadow-lg p-6 border border-cream-200";
      card.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="font-bold text-brown-800 text-xl">${c.name}</h3>
            <p class="text-brown-700 mt-1">${c.desc}</p>
          </div>
          <span class="text-sm font-bold text-brand-green bg-cream-100 px-3 py-1 rounded-full">${qty}</span>
        </div>
        <div class="flex gap-3 mt-5">
          <button class="w-full px-4 py-3 rounded-md font-semibold bg-white border border-cream-300 text-brown-800 hover:opacity-90 transition" data-action="minus">âˆ’</button>
          <button class="w-full px-4 py-3 rounded-md font-semibold bg-brand-yellow text-white hover:opacity-90 transition" data-action="plus">+</button>
        </div>
      `;

      card.querySelector('[data-action="minus"]').onclick = () => {
        if (qty > 0) {
          selection[c.name] = qty - 1;
          if (selection[c.name] === 0) delete selection[c.name];
          render();
        }
      };

      card.querySelector('[data-action="plus"]').onclick = () => {
        if (totalSelected() < requiredCount()) {
          selection[c.name] = qty + 1;
          render();
        }
      };

      grid.appendChild(card);
    });

    updateUI();
  }

  function randomDraft() {
    selection = {};
    let remaining = requiredCount();
    while (remaining > 0) {
      const pick = COOKIES[Math.floor(Math.random() * COOKIES.length)].name;
      selection[pick] = (selection[pick] || 0) + 1;
      remaining--;
    }
    render();
  }

  boxTypeEl.onchange = () => {
    boxType = boxTypeEl.value;
    selection = {};
    render();
  };

  document.getElementById("reset").onclick = () => { selection = {}; render(); };
  document.getElementById("randomize").onclick = () => randomDraft();

  checkoutBtn.onclick = async () => {
    const giftNote = (document.getElementById("giftNote").value || "").slice(0, 400);

    const payload = { boxType, selection, giftNote };
    const res = await fetch(API_CREATE_SESSION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    const data = await res.json();
    if (data.url) window.location.href = data.url;
    else alert(data.error || "Could not start checkout.");
  };

  render();
</script>
</body>
</html>
